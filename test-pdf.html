<!DOCTYPE html>
<html>
<head>
    <title>Test PDF Upload</title>
</head>
<body>
    <h1>Test PDF Upload to S3</h1>
    
    <div>
        <label>Post ID:</label>
        <input type="number" id="postId" value="25" required>
    </div>
    
    <div>
        <label>PDF File:</label>
        <input type="file" id="pdfFile" accept=".pdf" required>
    </div>
    
    <div>
        <label>Title (optional):</label>
        <input type="text" id="title" placeholder="File title">
    </div>
    
    <button onclick="uploadPdf()">Upload PDF</button>
    
    <div id="result"></div>

    <script>
        async function uploadPdf() {
            const postId = document.getElementById('postId').value;
            const fileInput = document.getElementById('pdfFile');
            const title = document.getElementById('title').value;
            
            if (!postId || !fileInput.files[0]) {
                alert('Please select a post ID and PDF file');
                return;
            }

            const formData = new FormData();
            formData.append('files', fileInput.files[0]);
            if (title) {
                formData.append('title', title);
            }

            try {
                document.getElementById('result').innerHTML = '<p>Uploading...</p>';
                
                const response = await fetch(`http://localhost:3001/api/news/${postId}/files`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                document.getElementById('result').innerHTML = `
                    <h3>Upload successful!</h3>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                
                // Показываем обновленный пост
                showPost(postId);
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <h3>Upload failed!</h3>
                    <p>Error: ${error.message}</p>
                `;
                console.error('Upload error:', error);
            }
        }

        async function showPost(postId) {
            try {
                const response = await fetch(`http://localhost:3001/api/news/${postId}`);
                const post = await response.json();
                
                let html = `<h3>Post: ${post.title}</h3>`;
                
                if (post.files && post.files.length > 0) {
                    html += `<h4>Files:</h4>`;
                    post.files.forEach(file => {
                        html += `<div style="border: 1px solid #ccc; padding: 10px; margin: 5px;">`;
                        html += `<p><strong>Title:</strong> ${file.title}</p>`;
                        html += `<p><strong>Original Name:</strong> ${file.originalName}</p>`;
                        html += `<p><strong>MIME Type:</strong> ${file.mimeType}</p>`;
                        html += `<p><strong>Size:</strong> ${file.size} bytes</p>`;
                        html += `<p><strong>URL:</strong> <a href="${file.url}" target="_blank">${file.url}</a></p>`;
                        html += `</div>`;
                    });
                } else {
                    html += `<p>No files found</p>`;
                }
                
                document.getElementById('result').innerHTML += html;
            } catch (error) {
                document.getElementById('result').innerHTML += `<p>Error loading post: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>